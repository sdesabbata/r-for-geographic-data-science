<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Data manipulation | R for Geographic Data Science</title>
<meta name="author" content="Stefano De Sabbata">
<meta name="description" content="Print this chapter Programming languages commonly provide both simple data types, such as those seen in the first chapter, and more complex objects capable of storing and organising multiple...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 3 Data manipulation | R for Geographic Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://sdesabbata.github.io/r-for-geographic-data-science/data-manipulation.html">
<meta property="og:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<meta property="og:description" content="Print this chapter Programming languages commonly provide both simple data types, such as those seen in the first chapter, and more complex objects capable of storing and organising multiple...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Data manipulation | R for Geographic Data Science">
<meta name="twitter:description" content="Print this chapter Programming languages commonly provide both simple data types, such as those seen in the first chapter, and more complex objects capable of storing and organising multiple...">
<meta name="twitter:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Geographic Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">1</span> Introduction to R</a></li>
<li><a class="" href="reproducible-data-science.html"><span class="header-section-number">2</span> Reproducible data science</a></li>
<li><a class="active" href="data-manipulation.html"><span class="header-section-number">3</span> Data manipulation</a></li>
<li><a class="" href="table-operations.html"><span class="header-section-number">4</span> Table operations</a></li>
<li class="book-part">Data analysis</li>
<li><a class="" href="exploratory-visualisation.html"><span class="header-section-number">5</span> Exploratory visualisation</a></li>
<li><a class="" href="exploratory-statistics.html"><span class="header-section-number">6</span> Exploratory statistics</a></li>
<li><a class="" href="comparing-data.html"><span class="header-section-number">7</span> Comparing data</a></li>
<li><a class="" href="regression-analysis.html"><span class="header-section-number">8</span> Regression analysis</a></li>
<li><a class="" href="multiple-regression.html"><span class="header-section-number">9</span> Multiple regression</a></li>
<li class="book-part">Machine learning</li>
<li><a class="" href="supervised-machine-learning.html"><span class="header-section-number">10</span> Supervised machine learning</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">11</span> Unsupervised machine learning</a></li>
<li class="book-part">R scripting</li>
<li><a class="" href="r-scripting.html"><span class="header-section-number">12</span> R scripting</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="appendix-1.html">Appendix 1</a></li>
<li><a class="" href="solutions.html">Solutions</a></li>
<li><a class="" href="groupwork-exercise.html">Groupwork exercise</a></li>
<li><a class="" href="lecture-slides.html">Lecture slides</a></li>
<li><a class="" href="reading-list.html">Reading list</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/sdesabbata/r-for-geographic-data-science">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-manipulation" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Data manipulation<a class="anchor" aria-label="anchor" href="#data-manipulation"><i class="fas fa-link"></i></a>
</h1>
<p><br><small><a href="javascript:if(window.print)window.print()">Print this chapter</a></small></p>
<p>Programming languages commonly provide both simple data types, such as those seen in the <a href="introduction-to-r.html">first chapter</a>, and more complex objects capable of storing and organising multiple values, such as the tables that we have briefly seen in action in the <a href="reproducible-data-science.html">second chapter</a>. In this chapter we bridge that gap by discussing a series of complex data types and how to manipulate the information they store. In doing so, we discuss the <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> library (also part of the Tidyverse), which it offers a grammar for data manipulation.</p>
<p>Before continuing, create a new R project named <em>GY7702-practical-103</em> and create a new R script named <code>complex-data-types.R</code>. Follow along with the examples below by copy-pasting the code in the script and then running one line at the time.</p>
<div id="complex-data-types" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Complex data types<a class="anchor" aria-label="anchor" href="#complex-data-types"><i class="fas fa-link"></i></a>
</h2>
<div id="vectors" class="section level3" number="3.1.1">
<h3>
<span class="header-section-number">3.1.1</span> Vectors<a class="anchor" aria-label="anchor" href="#vectors"><i class="fas fa-link"></i></a>
</h3>
<p>The simplest of the complex objects usually allow storing multiple values of the same type in an ordered list. Such objects take different names in different languages. In <code>R</code>, they are referred to as <strong>vectors</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The term &lt;em&gt;list&lt;/em&gt; has a specific meaning in &lt;code&gt;R&lt;/code&gt;. Don’t use the term &lt;em&gt;list&lt;/em&gt; to refer to &lt;em&gt;vectors&lt;/em&gt;.&lt;/p&gt;"><sup>16</sup></a>.</p>
<p>Vectors can be defined in R by using the function <code>c</code>, which takes as parameters the items to be stored in the vector. The items are stored in the order in which they are provided.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">east_midlands_cities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Derby"</span>, <span class="st">"Leicester"</span>, <span class="st">"Lincoln"</span>, <span class="st">"Nottingham"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">east_midlands_cities</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or using the pipe operator</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">east_midlands_cities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Once the vector has been created and assigned to an identifier, the elements within the vector can be retrieved by specifying the identifier, followed by square brackets and the <em>index</em> (or indices as we will see further below) of the elements to be retrieved. Indices start from <code>1</code>, so the index of the first element is <code>1</code>, the index of the second element is <code>2</code>, and so on and so forth<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;That is different from many programming languages, where the index of the first element is &lt;code&gt;0&lt;/code&gt;.&lt;/p&gt;"><sup>17</sup></a>.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the third city</span></span>
<span><span class="va">east_midlands_cities</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] "Lincoln"</code></pre>
<p>Alternatively, the <code>first</code>, <code>last</code>, or <code>nth</code> functions of the <code>dplyr</code> library within Tidyverse can be used to extract single values from vectors.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the first city</span></span>
<span><span class="va">east_midlands_cities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Derby"</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the first city</span></span>
<span><span class="va">east_midlands_cities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">nth</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Derby"</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the third city</span></span>
<span><span class="va">east_midlands_cities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">nth</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Lincoln"</code></pre>
<p>To retrieve any subset of a vector (i.e., more than one element), you can specify an integer vector containing the indices (rather than a single integer value) of the items of interest between square brackets.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve first and third city</span></span>
<span><span class="va">east_midlands_cities</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] "Derby"   "Lincoln"</code></pre>
<p>Functions and operators can be applied to vectors in the same way as they would be applied to simple values. For instance, all built-in numerical functions in R can be used on a vector variable directly. That is, if a vector is specified as input, the selected function is applied to each element of the vector.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_to_ten</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">one_to_ten</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_to_ten</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<pre><code>##  [1]  2  3  4  5  6  7  8  9 10 11</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">one_to_ten</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751 2.828427
##  [9] 3.000000 3.162278</code></pre>
<p>Similarly, string functions can be applied to vectors containing character values. For instance, the code below uses <code>str_length</code> to obtain a vector of numeric values representing the lengths of the city names included in the vector of character values <code>east_midlands_cities</code>.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">east_midlands_cities</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  5  9  7 10</code></pre>
<p>As seen in the previous chapter, a condition entered in the Console is evaluated for the provided input, and a logical value (<code>TRUE</code> or <code>FALSE</code>) is provided as output. Similarly, if the provided input is a vector, the condition is evaluated for each element of the vector, and a vector of logical values is returned – which contains the respective results of the conditions for each element.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">-</span><span class="fl">3</span> <span class="op">&gt;</span> <span class="fl">0</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minus_two_to_two</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">minus_two_to_two</span> <span class="op">&gt;</span> <span class="fl">0</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE  TRUE</code></pre>
<p>A subset of the elements of a vector can also be selected by providing a vector of logical values between brackets after the identifier. A new vector is returned, containing only the values for which a <code>TRUE</code> value has been specified correspondingly.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minus_two_to_two</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] -2 -1  2</code></pre>
<p>As the result of evaluating the condition on a vector is a vector of logical values, this can be used to filter vectors based on conditions. If a condition is provided between square brackets (after the vector identifier instead of an index), a new vector is returned, which contains only the elements for which the condition is true.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minus_two_to_two</span> <span class="op">&gt;</span> <span class="fl">0</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minus_two_to_two</span><span class="op">[</span><span class="va">minus_two_to_two</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<p>A <strong>factor</strong> is a data type similar to a vector. However, the values contained in a factor can only be selected from a set of <strong>levels</strong>. The code below illustrates the difference between vectors and factors.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">houses_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bungalow"</span>, <span class="st">"Flat"</span>, <span class="st">"Flat"</span>,</span>
<span>  <span class="st">"Detached"</span>, <span class="st">"Flat"</span>, <span class="st">"Terrace"</span>, <span class="st">"Terrace"</span><span class="op">)</span></span>
<span><span class="va">houses_vector</span></span></code></pre></div>
<pre><code>## [1] "Bungalow" "Flat"     "Flat"     "Detached" "Flat"     "Terrace"  "Terrace"</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">houses_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bungalow"</span>, <span class="st">"Flat"</span>, <span class="st">"Flat"</span>,</span>
<span>  <span class="st">"Detached"</span>, <span class="st">"Flat"</span>, <span class="st">"Terrace"</span>, <span class="st">"Terrace"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">houses_factor</span></span></code></pre></div>
<pre><code>## [1] Bungalow Flat     Flat     Detached Flat     Terrace  Terrace 
## Levels: Bungalow Detached Flat Terrace</code></pre>
<p>R also provides a data type named <strong>ordered</strong>, which is similar to the data type factor but the levels are considered as ordered categories and respond to operators like <code>&gt;</code> (greater then) when filtered. <strong><a href="appendix-1.html">Appending 1</a></strong> provides some more details on vectors for those eager to lear – or if you get stuck with your code and feel like knowing more about how to work with vectors might help. 😊</p>
</div>
<div id="lists" class="section level3" number="3.1.2">
<h3>
<span class="header-section-number">3.1.2</span> Lists<a class="anchor" aria-label="anchor" href="#lists"><i class="fas fa-link"></i></a>
</h3>
<p>Variables of the type <strong>list</strong> can contain elements of different types (including vectors and matrices), whereas elements of vectors are all of the same type.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employee</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Stef"</span>, <span class="fl">2015</span><span class="op">)</span></span>
<span><span class="va">employee</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "Stef"
## 
## [[2]]
## [1] 2015</code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employee</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># Note the double square brackets for selection</span></span></code></pre></div>
<pre><code>## [1] "Stef"</code></pre>
<p>In <strong>named lists</strong> each element has a name, and elements can be selected using their name after the symbol <code>$</code>.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employee</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>employee_name <span class="op">=</span> <span class="st">"Stef"</span>, start_year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></span>
<span><span class="va">employee</span></span></code></pre></div>
<pre><code>## $employee_name
## [1] "Stef"
## 
## $start_year
## [1] 2015</code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employee</span><span class="op">$</span><span class="va">employee_name</span></span></code></pre></div>
<pre><code>## [1] "Stef"</code></pre>
</div>
</div>
<div id="data-frames-and-tibbles" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Data frames and tibbles<a class="anchor" aria-label="anchor" href="#data-frames-and-tibbles"><i class="fas fa-link"></i></a>
</h2>
<p>As mentioned in the first chapter, <strong>data frames</strong> are complex data types which encode the concept of a table in R by combining and arranging together a series of simple objects. Data frames are similar to named lists, where each element of the list is a vector representing a column and all vectors have the same length, thus representing the same number of rows.</p>
<p>In the Tidyverse, a <a href="https://tibble.tidyverse.org/"><code>tibble</code></a> is defined as: “a modern re-imagining of the data frame, keeping what time has proven to be effective, and throwing out what it has not. Tibbles are data.frames that are lazy and surly: they do less and complain more forcing you to confront problems earlier, typically leading to cleaner, more expressive code”.</p>
<p>Before continuing, create a <em>data</em> subfolder and copy the <code>2011_OAC_Raw_uVariables_Leicester.csv</code> file in the <em>data</em> subfolder. Then, create a new RMarkdown documemnt to be compiled as a PDF file, using <em>Data manipulation</em> as a title and <code>data-manipulation.Rmd</code> as file name. Follow along with the examples below by copy-pasting the code in new R chunks, running them one at the time and then compiling the whole document.</p>
<div id="selecting-and-filtering-tables" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Selecting and filtering tables<a class="anchor" aria-label="anchor" href="#selecting-and-filtering-tables"><i class="fas fa-link"></i></a>
</h3>
<p>The approaches seen above for selecting and filtering data from vectors can be applied to data frames and tibbles. The only difference is that tables are bi-dimensional (rather than one-dimensional), and thus, two pieces of information are necessary. The first index specifies which rows to select or filter, and the second index specifies which columns to select or filter. If no information is provided for either the first or second index, all rows or columns are provided. However, as you can see from the examples below, the more complex the selection and filtering query become, the longer and less readable the code becomes.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the Leicester 2011 OAC dataset from the csv file</span></span>
<span><span class="va">leicester_2011OAC</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"2011_OAC_Raw_uVariables_Leicester.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the 5th row</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="fl">5</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the 9th column (OAC supergroup name)</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span>, <span class="fl">9</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the 5th row and 9th column</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">9</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the OAC supergroup name column (9th column) of the 5th row</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="fl">5</span>, <span class="st">"supgrpname"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the OA code, OAC supergroup code name columns of the 5th row</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OA11CD"</span>, <span class="st">"supgrpcode"</span>, <span class="st">"supgrpname"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the OA code, OAC supergroup code name columns</span></span>
<span><span class="co"># of the 5th to 10th rows </span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OA11CD"</span>, <span class="st">"supgrpcode"</span>, <span class="st">"supgrpname"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the OA code, OAC supergroup code name columns</span></span>
<span><span class="co"># for all OAs with more than 600 inhabitants</span></span>
<span><span class="va">leicester_2011OAC</span><span class="op">[</span><span class="va">leicester_2011OAC</span><span class="op">$</span><span class="va">Total_Population</span> <span class="op">&gt;</span> <span class="fl">600</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OA11CD"</span>, <span class="st">"supgrpcode"</span>, <span class="st">"supgrpname"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Fortunately, rather than working with base R instructions, we can use the <code>dplyr</code> library, which is part of the Tidyverse and offers a grammar for data manipulation. The function <code>select</code> can be used to select some <strong>columns</strong> to output. For instance, in the code below, the function <code>select</code> is used to select the columns <code>OA11CD</code>, <code>supgrpcode</code>, and <code>supgrpname</code>, in combination with the function <code>slice_head</code>, which can be used to include only the first <code>n</code> rows (<code>5</code> in the example below) to output.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">supgrpcode</span>, <span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="right">supgrpcode</th>
<th align="left">supgrpname</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00069517</td>
<td align="right">6</td>
<td align="left">Suburbanites</td>
</tr>
<tr class="even">
<td align="left">E00069514</td>
<td align="right">2</td>
<td align="left">Cosmopolitans</td>
</tr>
<tr class="odd">
<td align="left">E00169516</td>
<td align="right">4</td>
<td align="left">Multicultural Metropolitans</td>
</tr>
<tr class="even">
<td align="left">E00169048</td>
<td align="right">4</td>
<td align="left">Multicultural Metropolitans</td>
</tr>
<tr class="odd">
<td align="left">E00169044</td>
<td align="right">4</td>
<td align="left">Multicultural Metropolitans</td>
</tr>
</tbody>
</table></div>
<p>The function <code>filter</code> can instead be used to filter <strong>rows</strong> based on a specified condition. In the example below, the output of the <code>filter</code> step only includes the rows where the value of <code>grpname</code> is <code>"Students Around Campus"</code> (i.e., OAs classified as part of the Students Around Campus group). Note that the <code>grpname</code> needs to be included in the <code>select</code> step in order to be able to used it in the subsequent <code>filter</code> operation. All functions in the <code>dplyr</code> library can be combined in any other order that makes logical sense. However, if the <code>select</code> step didn’t include <code>grpname</code>, that same column couldn’t have been used in the <code>filter</code> step.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">supgrpname</span>, <span class="va">grpname</span>, <span class="va">Total_Population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">grpname</span> <span class="op">==</span> <span class="st">"Students Around Campus"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="left">supgrpname</th>
<th align="left">grpname</th>
<th align="right">Total_Population</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00069514</td>
<td align="left">Cosmopolitans</td>
<td align="left">Students Around Campus</td>
<td align="right">323</td>
</tr>
<tr class="even">
<td align="left">E00068882</td>
<td align="left">Cosmopolitans</td>
<td align="left">Students Around Campus</td>
<td align="right">285</td>
</tr>
<tr class="odd">
<td align="left">E00169553</td>
<td align="left">Cosmopolitans</td>
<td align="left">Students Around Campus</td>
<td align="right">714</td>
</tr>
<tr class="even">
<td align="left">E00068869</td>
<td align="left">Cosmopolitans</td>
<td align="left">Students Around Campus</td>
<td align="right">319</td>
</tr>
<tr class="odd">
<td align="left">E00068876</td>
<td align="left">Cosmopolitans</td>
<td align="left">Students Around Campus</td>
<td align="right">255</td>
</tr>
</tbody>
</table></div>
</div>
<div id="summarise" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Summarise<a class="anchor" aria-label="anchor" href="#summarise"><i class="fas fa-link"></i></a>
</h3>
<p>the function <code>count</code> of the <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> library can be used to count the number of rows in a data frame. The code below provides the <code>leicester_2011OAC</code> dataframe (as read in input in the section above) as input to the function <code>count</code> through the pipe operator, thus creating a new <a href="https://tibble.tidyverse.org/"><code>tibble</code></a> with only one row and one column, containing the number of rows in that dataframe – that is, the number of OAs in Leicester.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">n</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">969</td>
</tr></tbody>
</table></div>
<p>As discussed in the previous lecture, a <a href="https://tibble.tidyverse.org/"><code>tibble</code></a> is a data type similar to data frames, used by all the Tidyverse libraries. All Tidyverse functions output <code>tibble</code> rather than <code>data.frame</code> objects when representing a table. However, <code>data.frame</code> object can be provided as input, as they are automatically converted by Tidyverse functions before proceeding with the processing steps.</p>
<p>The example above already shows how the <strong>pipe operator</strong> can be used effectively in a multi-step operation. In the <code>tibble</code> outputted by the <code>count</code> function above, the column <code>n</code> provides the count. The function <code>kable</code> of the library <code>knitr</code> is used to produce a well-formatted table.</p>
<p>Note how the code above goes to a new line after every <code>%&gt;%</code>, and space is added at the beginning of new lines. That is very common in R programming (especially when functions have many parameters) as it makes the code more readable.</p>
<p>The verb <code>count</code> is a special case (a shorthand) of the more general verb <code>summarise</code> (<code>summarize</code> using the American English spelling is also available with the same functionality), which allows generating tables presenting aggregate values of input data.</p>
<p>For instance, <code>summarise</code> can be used to create a table containing:</p>
<ul>
<li>a column presenting the total population of Leicester;</li>
<li>a column presenting the total number of OAs in Leicester;</li>
<li>a column presenting the average population per OAs in Leicester;</li>
<li>a column presenting a logical value stating whether any OA in Leicester contains more than 600 people.</li>
</ul>
<p>That can be achieved applying different aggregate functions to the same column (<code>Total_Population</code>) of the <code>leicester_2011OAC</code> as illustrated below.</p>
<ul>
<li>
<code>sum</code> to calculate the total population of Leicester;</li>
<li>
<code>n</code> to count the number of rows (as mentioned above <code>count</code> is a shorthand for the combination of <code>summarise</code> with <code>n</code>);</li>
<li>
<code>mean</code> to calculate the average population per OAs in Leicester;</li>
<li>
<code>any</code> with a conditional statement comparing <code>Total_Population</code> and the value <code>600</code> using the numeric operator <code>&gt;</code> (greater than) to assess whether any OA in Leicester contains more than 600 people.</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co"># Total population in Leicester</span></span>
<span>    tot_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>,</span>
<span>    <span class="co"># Number of OAs, no input column needed</span></span>
<span>    num_of_OAs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Average population</span></span>
<span>    avg_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>, </span>
<span>    <span class="co"># Is there any OA with over 200 people?</span></span>
<span>    pop_over_600 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">Total_Population</span> <span class="op">&gt;</span> <span class="fl">600</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">tot_pop</th>
<th align="right">num_of_OAs</th>
<th align="right">avg_pop</th>
<th align="left">pop_over_600</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">329839</td>
<td align="right">969</td>
<td align="right">340.3911</td>
<td align="left">TRUE</td>
</tr></tbody>
</table></div>
<p>A set of aggregate functions which are frequently used with <code>summarise</code> is available in <a href="https://dplyr.tidyverse.org/reference/summarise.html#useful-functions">the <code>dplyr</code> page on <code>summarise</code></a>.</p>
<p>To carry out more complex aggregations, the function <code>summarise</code> can be used in combination with the function <code>group_by</code> to summarise the values in the data frame based on groups. Rows having the same value for the column specified for the verb <code>group_by</code> (in the example below, the 2011 OAC supergroup, <code>supgrpname</code>) are grouped together, then values are aggregated based on the functions specified for the verb <code>summarise</code> (using one or more columns in the calculation).</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co"># Total population in Leicester</span></span>
<span>    tot_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>,</span>
<span>    <span class="co"># Number of OAs, no input column needed</span></span>
<span>    num_of_OAs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Average population</span></span>
<span>    avg_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>, </span>
<span>    <span class="co"># Is there any OA with over 200 people?</span></span>
<span>    pop_over_600 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">Total_Population</span> <span class="op">&gt;</span> <span class="fl">600</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="40%">
<col width="11%">
<col width="15%">
<col width="13%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">tot_pop</th>
<th align="right">num_of_OAs</th>
<th align="right">avg_pop</th>
<th align="left">pop_over_600</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Constrained City Dwellers</td>
<td align="right">9263</td>
<td align="right">36</td>
<td align="right">257.3056</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">26813</td>
<td align="right">83</td>
<td align="right">323.0482</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">19137</td>
<td align="right">57</td>
<td align="right">335.7368</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">32069</td>
<td align="right">101</td>
<td align="right">317.5149</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">205007</td>
<td align="right">573</td>
<td align="right">357.7784</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">17326</td>
<td align="right">54</td>
<td align="right">320.8519</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">20224</td>
<td align="right">65</td>
<td align="right">311.1385</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table></div>
<p>The shorthand function <code>count</code> also has the option to specify a column that will be used for an internal grouping. In the example below, the column name <code>supgrpname</code> is provided as an argument to the function <code>count</code>. As a result, the output shows the number of rows grouped by 2011 OAC supergroup.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Constrained City Dwellers</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">83</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">101</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">573</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">54</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">65</td>
</tr>
</tbody>
</table></div>
</div>
<div id="mutate" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Mutate<a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code>mutate</code> can be used to create a new column by conducting operations on current columns. For instance, in the example below, <code>summarise</code> is first used to calculate the total number of people and the number of OAs per 2011 OAC supergroup. The verb <code>mutate</code> is then used to calculate the average population per OA per 2011 OAC supergroup, recreating the same <code>avg_pop</code> column as above but through a different process.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co"># Total population in Leicester</span></span>
<span>    tot_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>,</span>
<span>    <span class="co"># Number of OAs, no input column needed</span></span>
<span>    num_of_OAs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Is there any OA with over 200 people?</span></span>
<span>    pop_over_600 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">Total_Population</span> <span class="op">&gt;</span> <span class="fl">600</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Average population</span></span>
<span>    avg_pop <span class="op">=</span> <span class="va">tot_pop</span> <span class="op">/</span> <span class="va">num_of_OAs</span>, </span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="41%">
<col width="11%">
<col width="16%">
<col width="19%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">tot_pop</th>
<th align="right">num_of_OAs</th>
<th align="left">pop_over_600</th>
<th align="right">avg_pop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Constrained City Dwellers</td>
<td align="right">9263</td>
<td align="right">36</td>
<td align="left">FALSE</td>
<td align="right">257.31</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">26813</td>
<td align="right">83</td>
<td align="left">TRUE</td>
<td align="right">323.05</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">19137</td>
<td align="right">57</td>
<td align="left">FALSE</td>
<td align="right">335.74</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">32069</td>
<td align="right">101</td>
<td align="left">FALSE</td>
<td align="right">317.51</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">205007</td>
<td align="right">573</td>
<td align="left">TRUE</td>
<td align="right">357.78</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">17326</td>
<td align="right">54</td>
<td align="left">FALSE</td>
<td align="right">320.85</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">20224</td>
<td align="right">65</td>
<td align="left">FALSE</td>
<td align="right">311.14</td>
</tr>
</tbody>
</table></div>
<p>In this second example, the <code>u005</code> column (which represents the area of the OA in <a href="https://en.wikipedia.org/wiki/Hectare">hectares</a>, see <code>2011_OAC_Raw_uVariables_Lookup.csv</code>) is used to calculate the population density for each OA.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Population density</span></span>
<span>    pop_density <span class="op">=</span> <span class="va">Total_Population</span> <span class="op">/</span> <span class="va">u005</span>, </span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">pop_density</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="right">pop_density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00069517</td>
<td align="right">33.69</td>
</tr>
<tr class="even">
<td align="left">E00069514</td>
<td align="right">131.30</td>
</tr>
<tr class="odd">
<td align="left">E00169516</td>
<td align="right">240.14</td>
</tr>
<tr class="even">
<td align="left">E00169048</td>
<td align="right">104.23</td>
</tr>
<tr class="odd">
<td align="left">E00169044</td>
<td align="right">99.08</td>
</tr>
<tr class="even">
<td align="left">E00069041</td>
<td align="right">51.31</td>
</tr>
<tr class="odd">
<td align="left">E00169049</td>
<td align="right">42.53</td>
</tr>
<tr class="even">
<td align="left">E00068806</td>
<td align="right">57.78</td>
</tr>
<tr class="odd">
<td align="left">E00068886</td>
<td align="right">122.87</td>
</tr>
<tr class="even">
<td align="left">E00068807</td>
<td align="right">76.21</td>
</tr>
</tbody>
</table></div>
</div>
<div id="arrange" class="section level3" number="3.2.4">
<h3>
<span class="header-section-number">3.2.4</span> Arrange<a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code>arrange</code> can be used to sort a tibble by ascending order of the values in the specified column. If the operator <code>-</code> is specified before the column name, the descending order is used. The code below would produce a table showing the ten OAs with the largest population in Leicester.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">OA11CD</span>, <span class="va">supgrpname</span>, </span>
<span>    <span class="va">Total_Population</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span></span>
<span>    <span class="co"># Descending delay</span></span>
<span>    <span class="op">-</span><span class="va">Total_Population</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In the example above, we have used <code>slice_head</code> to present only the first <code>n</code> (in the example <code>10</code>) rows in a table based on the existing order. The <code>dplyr</code> library also provides the functions <code>slice_max</code> and <code>slice_min</code> which incorporate the sorting functionality (see <a href="https://dplyr.tidyverse.org/reference/slice.html"><code>slice</code> reference page</a>).</p>
<p>As such, the following code uses <code>slice_max</code> to produce a table including only the 10 OAs with the <em>highest</em> population.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">OA11CD</span>, <span class="va">supgrpname</span>, </span>
<span>    <span class="va">Total_Population</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span></span>
<span>    <span class="va">Total_Population</span>, </span>
<span>    n <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="left">supgrpname</th>
<th align="right">Total_Population</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00169553</td>
<td align="left">Cosmopolitans</td>
<td align="right">714</td>
</tr>
<tr class="even">
<td align="left">E00168096</td>
<td align="left">Cosmopolitans</td>
<td align="right">708</td>
</tr>
<tr class="odd">
<td align="left">E00069303</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">623</td>
</tr>
<tr class="even">
<td align="left">E00169458</td>
<td align="left">Cosmopolitans</td>
<td align="right">622</td>
</tr>
<tr class="odd">
<td align="left">E00069304</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">608</td>
</tr>
<tr class="even">
<td align="left">E00169575</td>
<td align="left">Cosmopolitans</td>
<td align="right">597</td>
</tr>
<tr class="odd">
<td align="left">E00069393</td>
<td align="left">Ethnicity Central</td>
<td align="right">591</td>
</tr>
<tr class="even">
<td align="left">E00169564</td>
<td align="left">Cosmopolitans</td>
<td align="right">591</td>
</tr>
<tr class="odd">
<td align="left">E00069482</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">590</td>
</tr>
<tr class="even">
<td align="left">E00069216</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">586</td>
</tr>
<tr class="odd">
<td align="left">E00169446</td>
<td align="left">Cosmopolitans</td>
<td align="right">586</td>
</tr>
<tr class="even">
<td align="left">E00069439</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">586</td>
</tr>
</tbody>
</table></div>
<p>The following code, instead, uses <code>slice_min</code>, thus producing a table including only the 10 OAs with the <em>lowest</em> population..</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">OA11CD</span>, <span class="va">supgrpname</span>, </span>
<span>    <span class="va">Total_Population</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min</a></span><span class="op">(</span></span>
<span>    <span class="va">Total_Population</span>, </span>
<span>    n <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="left">supgrpname</th>
<th align="right">Total_Population</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00169530</td>
<td align="left">Ethnicity Central</td>
<td align="right">103</td>
</tr>
<tr class="even">
<td align="left">E00169528</td>
<td align="left">Ethnicity Central</td>
<td align="right">119</td>
</tr>
<tr class="odd">
<td align="left">E00069382</td>
<td align="left">Ethnicity Central</td>
<td align="right">126</td>
</tr>
<tr class="even">
<td align="left">E00069149</td>
<td align="left">Cosmopolitans</td>
<td align="right">131</td>
</tr>
<tr class="odd">
<td align="left">E00069332</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">132</td>
</tr>
<tr class="even">
<td align="left">E00168107</td>
<td align="left">Multicultural Metropolitans</td>
<td align="right">133</td>
</tr>
<tr class="odd">
<td align="left">E00168094</td>
<td align="left">Cosmopolitans</td>
<td align="right">141</td>
</tr>
<tr class="even">
<td align="left">E00169486</td>
<td align="left">Cosmopolitans</td>
<td align="right">150</td>
</tr>
<tr class="odd">
<td align="left">E00069184</td>
<td align="left">Urbanites</td>
<td align="right">158</td>
</tr>
<tr class="even">
<td align="left">E00169472</td>
<td align="left">Constrained City Dwellers</td>
<td align="right">160</td>
</tr>
</tbody>
</table></div>
<p>In both cases, if the table contains ties, all rows containing a value that is present among the maximum or minimum selected values are presented, as is the case with the rows containing the value <code>21</code> in the example above.</p>
</div>
<div id="data-manipulation-workflow" class="section level3" number="3.2.5">
<h3>
<span class="header-section-number">3.2.5</span> Data manipulation workflow<a class="anchor" aria-label="anchor" href="#data-manipulation-workflow"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, the code below illustrates a more complex, multi-step operation using all the functions discussed above. This is a full example of a short analysis using only one series of pipes to read, process and write data using <code>R</code> and almost all the <code>tidyverse</code> <em>verbs</em> seen so far.</p>
<p>The input data are read from the csv file and part of the data are selected and filtered. The data are grouped, aggregated and arranged in order. The percentage of people living in OAs assigned to each 2011 OAC supergroup is calculated. The <a href="https://magrittr.tidyverse.org/reference/tee.html">Tee pipe</a> (from the <code>magrittr</code> library) is used to write the resulting table to a file, while also passing the same input to the subsequent <code>kable</code> function to display the data.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's start from the filename</span></span>
<span><span class="st">"2011_OAC_supgrp_Leicester.csv"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as input to the read_csv function</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>col_types <span class="op">=</span> <span class="st">"cccci"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Select only the necessary columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">supgrpname</span>,    <span class="va">Total_Population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Let's say we are not interested in</span></span>
<span>  <span class="co"># the Suburbanites supergroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">supgrpname</span> <span class="op">!=</span> <span class="st">"Suburbanites"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Group by supergroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Aggregate population</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>tot_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Ungroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Arrange by descending total population</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">tot_pop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Calculate percentage</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_pop <span class="op">=</span> <span class="op">(</span><span class="va">tot_pop</span> <span class="op">/</span> <span class="fl">329839</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/tee.html">%T&gt;%</a></span></span>
<span>  <span class="co"># Then use the Tee pipe %T&gt;% in the line above</span></span>
<span>  <span class="co"># to write the calculated values to file</span></span>
<span>  <span class="co"># and pass the same input values to the kable function</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span></span>
<span>    <span class="st">"2011_Leicester_pop_per_OAC_supgrp_excl_suburb.csv"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Print to screen nicely</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">tot_pop</th>
<th align="right">perc_pop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">205007</td>
<td align="right">62.15</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">32069</td>
<td align="right">9.72</td>
</tr>
<tr class="odd">
<td align="left">Cosmopolitans</td>
<td align="right">26813</td>
<td align="right">8.13</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">20224</td>
<td align="right">6.13</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">19137</td>
<td align="right">5.80</td>
</tr>
<tr class="even">
<td align="left">Constrained City Dwellers</td>
<td align="right">9263</td>
<td align="right">2.81</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="componentization" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Componentization<a class="anchor" aria-label="anchor" href="#componentization"><i class="fas fa-link"></i></a>
</h2>
<p>It is important to note that in the example above, no information is stored in the local environment. The input is read directly from the computer storage, the whole process is conducted in the <code>R</code> internal memory, and the output is saved back to the computer storage. That is the whole purpose of the pipe operator: to avoid creating unnecessary and temporary “mid-products” during the computation (i.e., variables whose only purpose is to store the data before the next step).</p>
<p>However, it is frequently useful to split the processing into different steps, which allow the data to be inspected mid-way through the analysis or for the data to be used twice in two subsequent steps. Finding a good balance between too long and too short pipe sequences and too many or too few “mid-products” is the programmer’s task – and something that can only be learnt by experience and observing good examples of code.</p>
<p>The following example showcases how the process above can be subdivided into five meaningful steps.</p>
<ol style="list-style-type: decimal">
<li>Read the data. This is frequently done as a separate step, as some datasets might require significant time to be read from computer storage, and it is frequently best to read them only once.</li>
<li>Calculate the total population per 2011 OAC supergroup, excluding the suburban population. This is a significant transformation of the original data, which might be worth saving and inspecting.</li>
<li>Update the new table using mutate and the <a href="https://magrittr.tidyverse.org/reference/compound.html">assignment pipe operator <code>%&lt;&gt;%</code></a> (from the <code>magrittr</code> library).</li>
<li>Print the result.</li>
<li>Save the result to the computer storage.</li>
</ol>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># Let's start from the filename</span></span>
<span>  <span class="st">"2011_OAC_supgrp_Leicester.csv"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as input to the read_csv function</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>col_types <span class="op">=</span> <span class="st">"cccci"</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_nonsuburb_pop</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Select only the necessary columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">supgrpname</span>,    <span class="va">Total_Population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Let's say we are not interested in</span></span>
<span>  <span class="co"># the Suburbanites supergroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">supgrpname</span> <span class="op">!=</span> <span class="st">"Suburbanites"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Group by supergroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">supgrpname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Aggregate population</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>tot_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Ungroup</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Arrange by descending total population</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">tot_pop</span><span class="op">)</span></span>
<span></span>
<span><span class="va">leicester_nonsuburb_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span></span>
<span>  <span class="co"># Calculate percentage</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_pop <span class="op">=</span> <span class="op">(</span><span class="va">tot_pop</span> <span class="op">/</span> <span class="fl">329839</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_nonsuburb_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Print to screen nicely</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">tot_pop</th>
<th align="right">perc_pop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">205007</td>
<td align="right">62.15</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">32069</td>
<td align="right">9.72</td>
</tr>
<tr class="odd">
<td align="left">Cosmopolitans</td>
<td align="right">26813</td>
<td align="right">8.13</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">20224</td>
<td align="right">6.13</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">19137</td>
<td align="right">5.80</td>
</tr>
<tr class="even">
<td align="left">Constrained City Dwellers</td>
<td align="right">9263</td>
<td align="right">2.81</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_nonsuburb_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Write the calculated values to file</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span></span>
<span>    <span class="st">"2011_Leicester_pop_per_OAC_supgrp_excl_suburb.csv"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
</div>
<div id="exercises-103.1" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Exercises 103.1<a class="anchor" aria-label="anchor" href="#exercises-103.1"><i class="fas fa-link"></i></a>
</h2>
<p>Create an RMarkdown document in RStudio, using <em>Exercise 103</em> as title and <em>PDF</em> as output. Delete all the contents except the first five lines which compose the heading. Save the document as <code>practical-103_exercises.Rmd</code>. Add the libraries and code necessary to read the data from the <code>2011_OAC_Raw_uVariables_Leicester.csv</code> file. Create a first section of the document (e.g., adding a second heading <em>Exercise 103.1</em>) and add your answers to the questions below.</p>
<p>In order to answer the questions below, inspect the <strong>look-up</strong> table <code>2011_OAC_Raw_uVariables_Lookup.csv</code> (e.g., using Microsoft Excel) to identify the columns necessary to complete the task.</p>
<p><strong>Question 103.1.1:</strong> Identify the five variables which are part of the variable subdomain <em>Housing Type</em> and write the code necessary to compute the total number of household spaces in Leicester for each housing type.</p>
<p><strong>Question 103.1.2:</strong> Write the code necessary to compute the total number of household spaces in Leicester for each housing type grouped by 2011 OAC supergroup.</p>
<p><strong>Question 103.1.3:</strong> Write the code necessary to compute the percentage of household spaces (i.e., over to the total number of household spaces) in Leicester for each housing type grouped by 2011 OAC supergroup.</p>
<p><strong>Question 103.1.4:</strong> Modify the code written for <em>Question 103.1.3</em>, using <a href="https://dplyr.tidyverse.org/reference/rename.html">the verb <code>rename</code></a> to change the column names of the columns containing the percentages to names that resemble the related housing type (e.g., <code>perc_of_detached</code>).</p>
</div>
<div id="exercises-103.2" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Exercises 103.2<a class="anchor" aria-label="anchor" href="#exercises-103.2"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Question 103.2.1:</strong> Explore the <strong>look-up</strong> table <code>2011_OAC_Raw_uVariables_Lookup.csv</code> and identify another set of variables that you think might relate to the type of housing and the 2011 OAC supergroups. Create a new section of the document (e.g., adding a second heading) and include a short text (up to 200 words) in the RMarkdown document describing and justifying the set of variables you choose.</p>
<p><strong>Question 103.2.2:</strong> Write the code necessary to conduct the same analysis conducted for <em>Question 103.1</em> but using the variables identified in <em>Question 103.2.1</em>.</p>
<p><strong>Question 103.2.3:</strong> Inspect the table obtained from your answer to <em>Question 103.1.3</em> and the table obtained from your answer to <em>Question 103.2.2</em>, and compare the results. Write a short text (up to 300 words) in the RMarkdown document reporting and discussing what the results tell you about the socio-demographic structure of Leicester.</p>
<hr>
<p><small>by <a href="https://sdesabbata.github.io/">Stefano De Sabbata</a> – text licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>, contains public sector information licensed under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence">Open Government Licence v3.0</a>, code licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.html">GNU GPL v3.0</a>.</small></p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="reproducible-data-science.html"><span class="header-section-number">2</span> Reproducible data science</a></div>
<div class="next"><a href="table-operations.html"><span class="header-section-number">4</span> Table operations</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-manipulation"><span class="header-section-number">3</span> Data manipulation</a></li>
<li>
<a class="nav-link" href="#complex-data-types"><span class="header-section-number">3.1</span> Complex data types</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vectors"><span class="header-section-number">3.1.1</span> Vectors</a></li>
<li><a class="nav-link" href="#lists"><span class="header-section-number">3.1.2</span> Lists</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#data-frames-and-tibbles"><span class="header-section-number">3.2</span> Data frames and tibbles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#selecting-and-filtering-tables"><span class="header-section-number">3.2.1</span> Selecting and filtering tables</a></li>
<li><a class="nav-link" href="#summarise"><span class="header-section-number">3.2.2</span> Summarise</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">3.2.3</span> Mutate</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">3.2.4</span> Arrange</a></li>
<li><a class="nav-link" href="#data-manipulation-workflow"><span class="header-section-number">3.2.5</span> Data manipulation workflow</a></li>
</ul>
</li>
<li><a class="nav-link" href="#componentization"><span class="header-section-number">3.3</span> Componentization</a></li>
<li><a class="nav-link" href="#exercises-103.1"><span class="header-section-number">3.4</span> Exercises 103.1</a></li>
<li><a class="nav-link" href="#exercises-103.2"><span class="header-section-number">3.5</span> Exercises 103.2</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/sdesabbata/r-for-geographic-data-science/blob/main/src/book/103-data-manipulation.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/sdesabbata/r-for-geographic-data-science/edit/main/src/book/103-data-manipulation.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Geographic Data Science</strong>" was written by Stefano De Sabbata. It was last built on 2024-05-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
