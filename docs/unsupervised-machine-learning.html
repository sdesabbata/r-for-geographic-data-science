<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Unsupervised machine learning | R for Geographic Data Science</title>
<meta name="author" content="Stefano De Sabbata">
<meta name="description" content="Print this chapter  10.1 Introduction The field of machine learning sits at the intersection of computer science and statistics, and it is a core component of data science. According to Mitchell...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 10 Unsupervised machine learning | R for Geographic Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://sdesabbata.github.io/r-for-geographic-data-science/unsupervised-machine-learning.html">
<meta property="og:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<meta property="og:description" content="Print this chapter  10.1 Introduction The field of machine learning sits at the intersection of computer science and statistics, and it is a core component of data science. According to Mitchell...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Unsupervised machine learning | R for Geographic Data Science">
<meta name="twitter:description" content="Print this chapter  10.1 Introduction The field of machine learning sits at the intersection of computer science and statistics, and it is a core component of data science. According to Mitchell...">
<meta name="twitter:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2Y0M0936JL"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2Y0M0936JL');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Geographic Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">1</span> Introduction to R</a></li>
<li><a class="" href="r-programming.html"><span class="header-section-number">2</span> R programming</a></li>
<li class="book-part">Data wrangling</li>
<li><a class="" href="selection-and-manipulation.html"><span class="header-section-number">3</span> Selection and manipulation</a></li>
<li><a class="" href="table-operations.html"><span class="header-section-number">4</span> Table operations</a></li>
<li><a class="" href="reproducibility-1.html"><span class="header-section-number">5</span> Reproducibility</a></li>
<li class="book-part">Data analysis</li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">6</span> Exploratory data analysis</a></li>
<li><a class="" href="comparing-data.html"><span class="header-section-number">7</span> Comparing data</a></li>
<li><a class="" href="regression-analysis.html"><span class="header-section-number">8</span> Regression analysis</a></li>
<li class="book-part">Machine learning</li>
<li><a class="" href="supervised-machine-learning.html"><span class="header-section-number">9</span> Supervised machine learning</a></li>
<li><a class="active" href="unsupervised-machine-learning.html"><span class="header-section-number">10</span> Unsupervised machine learning</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="solutions.html">Solutions</a></li>
<li><a class="" href="lecture-slides.html">Lecture slides</a></li>
<li><a class="" href="reading-list.html">Reading list</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/sdesabbata/r-for-geographic-data-science">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="unsupervised-machine-learning" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Unsupervised machine learning<a class="anchor" aria-label="anchor" href="#unsupervised-machine-learning"><i class="fas fa-link"></i></a>
</h1>
<p><br><small><a href="javascript:if(window.print)window.print()">Print this chapter</a></small></p>
<div id="introduction-1" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>The field of <strong>machine learning</strong> sits at the intersection of computer science and statistics, and it is a core component of data science. According to Mitchell (1997), <em>“the field of machine learning is concerned with the question of how to construct computer programs that automatically improve with experience.”</em></p>
<p>Machine learning approaches are divided into two main types.</p>
<ul>
<li>
<strong>Supervised</strong>:
<ul>
<li>training of a <em>“predictive”</em> model from data;</li>
<li>one (or more) attribute of the dataset is used to “predict” another attribute.</li>
</ul>
</li>
<li>
<strong>Unsupervised</strong>:
<ul>
<li>discovery of <em>descriptive</em> patterns in data;</li>
<li>commonly used in data mining.</li>
</ul>
</li>
</ul>
<p>Clustering is a classic unsupervised machine learning task, which aims to <em>“automatically divides the data into</em> <strong><em>clusters</em></strong> <em>, or groups of similar items”</em>(Lantz, 2019). In computer science, a wide range of approaches has been developed to tackle clustering. Among those approaches, the two most common are centroid-based approaches (such as k-means) and hierarchical approaches. Other approaches include density-based clustering methods (such as DBSCAN) and mixed approaches (such as bagged clustering), which combine different aspects of centroid-based and hierarchical approaches.</p>
<div id="k-means" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> K-means<a class="anchor" aria-label="anchor" href="#k-means"><i class="fas fa-link"></i></a>
</h3>
<p>The k-mean approach clusters <span class="math inline">\(n\)</span> observations (<span class="math inline">\(x\)</span>) in <span class="math inline">\(k\)</span> clusters (<span class="math inline">\(c\)</span>) by minimising the within-cluster sum of squares (WCSS) through an iterative process. That is, the algorithm calculates the distance between each observation (i.e., each case, object, row in the table) and the centroid of its cluster. The square values of those distances are summed up for each cluster, and then for the whole dataset. The aim of the algorithm is minimise that value.</p>
<p><span class="math display">\[WCSS = \sum_{c=1}^{k} \sum_{x \in c} (x - \overline{x}_c)^2\]</span></p>
<p>To minimise WCSS, while trying to identify <code>k</code> clusters, k-mean first randomly select <code>k</code> observations as initial centroids. Then, k-means repeats the two steps below. Every time k-means repeats those two steps, the new centroids will be closer to the two actual centre. The process continues until centroids don’t change anymore (within a certain margin of error) or until it has reached a maximum number of iterations set by the analyst.</p>
<ul>
<li>
<strong>assignment step</strong>: observations assigned to closest centroids</li>
<li>
<strong>update step</strong>: calculate means for each cluster, as new the centroid</li>
</ul>
</div>
<div id="number-of-clusters" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">10.1.2</span> Number of clusters<a class="anchor" aria-label="anchor" href="#number-of-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>A key limitation of k-mean is that it requires to select the number of clusters to be identified in advance. Unfortunately, analysts are not always in the position of knowing in advance how many clusters are there supposed to be within the data they are analysing. In such cases, there are a number of heuristics that can be used to select the number of clusters that best fits the data.</p>
<p>The most well-known method is the <em>“elbow method”</em>. This approach suggests to calculate k-means for a range of values of k, calculate the WCSS obtained for each k, and then select the value of k that minimises WCSS without increasing the number of clusters beyond the point where the decrease in WCSS is minimal. This approach is called <em>“elbow method”</em> because (as can be seen in the examples below) when printing a line representing the value of WCSS for all values of k taken into account, it suggests to select the value of k at the <em>“elbow”</em> or inflation point of the line.</p>
<p>Other heuristics exist, which suggest using alternative measures of cluster quality. For instance, the <code>cluster</code> library provides simple ways to calculate the <a href="https://en.wikipedia.org/wiki/Silhouette_(clustering)">silhouette</a> measure and the <a href="http://web.stanford.edu/~hastie/Papers/gap.pdf">gap statistic</a>. The silhouette value indicates how well observations fit within their clusters, whereas the gap statistic measures the dispersion within each cluster, compared to a uniform distribution of values. The higher the value of the gap statistic, the further away the distribution is from uniform (thus the higher the quality of the clustering).</p>
<p>For all three heuristics, the best approach would be to calculate those values using a bootstrapping approach. That is, to calculate the same statistics multiple times on samples of the dataset, in order to account for random variation. However, only the <code>clusGap</code> function of the <code>cluster</code> library allows for bootstrapping natively, as illustrated below.</p>
</div>
<div id="geodemographic-classification" class="section level3" number="10.1.3">
<h3>
<span class="header-section-number">10.1.3</span> Geodemographic Classification<a class="anchor" aria-label="anchor" href="#geodemographic-classification"><i class="fas fa-link"></i></a>
</h3>
<p>In GIScience, clustering approaches are commonly used to create <em>geodemographic classifications</em>. For instance, <a href="http://josis.net/index.php/josis/article/view/232/150">Gale <em>et al.</em>, 2016</a> created the <a href="https://maps.cdrc.ac.uk/#/geodemographics/oac11/default/BTTTFFT/12/-1.1233/52.6454/">2011 Output Area Classification (2011 OAC)</a> starting from an initial set of 167 prospective variables from the UK Census 2011.</p>
<p>In the process of creating the classification, 86 variables were removed from the initial set, including highly correlated variables that don’t bring additional information to the classification process. Furthermore, 41 variable were retained as they were, whereas 40 were combined, to create final set of 60 variables. The k-mean approach was then applied to cluster the census Output Areas (OAs) into 8 supergroups, 26 groups and 76 subgroups.</p>
<p>The <a href="http://josis.net/index.php/josis/article/view/232/150">paper</a> provides a detail report of the process. In particular, it is interesting to see how the authors applied a process of variable selection involving repeated clustering while excluding one variable, to see how the within cluster sum of square measure (WCSS) would be affected. Variable that produced significantly higher WCSS when excluded were considered for exclusion from the final analysis, in order to increase the homogeneity of the clusters.</p>
<p>Once the clustering is completed, the final step in geodemographic classification is the interpretation of the resulting cluster, which is commonly done by observing the average values of the variables for each cluster.</p>
</div>
</div>
<div id="unsupervised-learning-examples" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Unsupervised learning examples<a class="anchor" aria-label="anchor" href="#unsupervised-learning-examples"><i class="fas fa-link"></i></a>
</h2>
<p>The two examples below explore the creation of simple geodemographic classifications for the city of Leicester, using a few variables from the United Kingdom 2011 Census and included among the 167 initial variables that <a href="http://josis.net/index.php/josis/article/view/232/150">Gale <em>et al.</em>, 2016</a> have taken into account in creating the <a href="https://maps.cdrc.ac.uk/#/geodemographics/oac11/default/BTTTFFT/12/-1.1233/52.6454/">2011 Output Area Classification</a>.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.5     ✔ purrr   0.3.4
## ✔ tibble  3.1.5     ✔ dplyr   1.0.7
## ✔ tidyr   1.1.4     ✔ stringr 1.4.0
## ✔ readr   2.0.2     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'magrittr'</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     extract</code></pre>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_2011OAC</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"2011_OAC_Raw_uVariables_Leicester.csv"</span><span class="op">)</span></code></pre></div>
<p>The variables that we are going to take into account are the five ones listed below, plus the total count for their statistical unit, that is <code>Total_Dwellings</code>.</p>
<ul>
<li>
<code>u086</code>: Detached</li>
<li>
<code>u087</code>: Semi-detached</li>
<li>
<code>u088</code>: Terraced (including end-terrace)</li>
<li>
<code>u089</code>: Flats</li>
<li>
<code>u090</code>: Caravan or other mobile or temporary structure</li>
</ul>
<p>The code below extracts the necessary variables from the original dataset and applies the normalisation steps across all the five variables listed above. Finally, the columns are renamed with more user-friendly names and adding <code>perc_</code> in front of the column name.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_dwellings</span> <span class="op">&lt;-</span>
  <span class="va">leicester_2011OAC</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">OA11CD</span>, <span class="va">Total_Dwellings</span>,
    <span class="va">u086</span><span class="op">:</span><span class="va">u090</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># scale across</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span> 
      <span class="va">u086</span><span class="op">:</span><span class="va">u090</span>,
      <span class="co">#scale</span>
      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="va">Total_Dwellings</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">}</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>
    detached <span class="op">=</span> <span class="va">u086</span>,
    semidetached <span class="op">=</span> <span class="va">u087</span>,
    terraced <span class="op">=</span> <span class="va">u088</span>,
    flats <span class="op">=</span> <span class="va">u089</span>,   
    carava_tmp <span class="op">=</span> <span class="va">u090</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># rename columns</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>
    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"perc_"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">}</span>,
    <span class="va">detached</span><span class="op">:</span><span class="va">carava_tmp</span>
  <span class="op">)</span></code></pre></div>
<p>The first step of k-means is to select some observations at random as initial centroids. As a result, every time we run the computation, the starting point will be slightly different, and so might be the result. In particular, it is likely that the cluster order might chance (i.e., what was cluster <code>1</code> one time might be cluster <code>3</code> the next), although the overall result should be stable. Nevertheless, to make this document more reproducible, we can set a <em>“seed”</em> for the generation of random numbers. That will ensure that the observations selected at random will be the same, and thus the results will be the same. That can be done in R, using the function <code>set.seed</code> and providing a number (any relatively large number will do) as <em>“seed”</em>.</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">20201208</span><span class="op">)</span></code></pre></div>
<div id="terrace-and-semi-detached-houses" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">10.2.1</span> Terrace and semi-detached houses<a class="anchor" aria-label="anchor" href="#terrace-and-semi-detached-houses"><i class="fas fa-link"></i></a>
</h3>
<p>The first example explores how to create a geodemographic classification using only two variables.</p>
<ul>
<li>
<code>u087</code> (now <code>semidetached</code>): Semi-detached</li>
<li>
<code>u088</code>(now <code>terraced</code>): Terraced (including end-terrace)</li>
</ul>
<p>As a first step, we can explore the relationship between the two variables. The code below illustrates the use of the <a href="https://ggobi.github.io/ggally/articles/ggpairs.html"><code>ggpairs</code></a> of the <a href="https://ggobi.github.io/ggally/"><code>GGally</code></a> library, which provides additional and more complex plots on top of the <code>ggplot2</code> framework.</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("GGally")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span>

<span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_semidetached</span>, <span class="va">perc_terraced</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span>
    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="va">ggally_cor</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span><span class="op">)</span>,
    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"points"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-6-1.png" width="288"></div>
<p>The scatterplot above seems to indicate that at least three clusters might exist in the data. One with a lot of semi-detached and few terraced house (top-left corner of the scatterplot); one with a lot of terraced and few semi-detached houses (bottom-right corner of the scatterplot); and one with very few of both classes (bottom-left corner of the scatterplot).</p>
<p>However, there are clearly many OAs which populate the area in between those three groups. So, what is the best approach to cluster those OAs?</p>
<p>The code below illustrates how to create three plots. The first follows the elbow method heuristic. The second and the third take a similar approach but using the silhouette and gap statistic.</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get only the data necessary for testing</span>
<span class="va">data_for_testing</span> <span class="op">&lt;-</span>
  <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_semidetached</span>, <span class="va">perc_terraced</span><span class="op">)</span>

<span class="co"># Calculate WCSS and silhouette</span>
<span class="co"># for k = 2 to 15</span>
<span class="co"># Set up two vectors where to store</span>
<span class="co"># the calculated WCSS and silhouette value</span>
<span class="va">testing_wcss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span>
<span class="va">testing_silhouette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span>

<span class="co"># for k = 2 to 15</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">testing_k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Calculate kmeans</span>
  <span class="va">kmeans_result</span> <span class="op">&lt;-</span> 
    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">data_for_testing</span>, centers <span class="op">=</span> <span class="va">testing_k</span>, iter.max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  
  <span class="co"># Extract WCSS</span>
  <span class="co"># and save it in the vector</span>
  <span class="va">testing_wcss</span><span class="op">[</span><span class="va">testing_k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">kmeans_result</span> <span class="op">%$%</span> <span class="va">tot.withinss</span>
  
  <span class="co"># Calculate average silhouette</span>
  <span class="co"># and save it in the vector</span>
  <span class="va">testing_silhouette</span><span class="op">[</span><span class="va">testing_k</span><span class="op">]</span> <span class="op">&lt;-</span> 
    <span class="va">kmeans_result</span> <span class="op">%$%</span> <span class="va">cluster</span> <span class="op">%&gt;%</span>
    <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span>
      <span class="va">data_for_testing</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">extract</a></span><span class="op">(</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Calculate the gap statistic using bootstrapping</span>
<span class="va">testing_gap</span> <span class="op">&lt;-</span> 
  <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/clusGap.html">clusGap</a></span><span class="op">(</span>
    <span class="va">data_for_testing</span>, 
    FUN <span class="op">=</span> <span class="va">kmeans</span>, 
    K.max <span class="op">=</span> <span class="fl">15</span>, <span class="co"># max number of clusters</span>
    B <span class="op">=</span> <span class="fl">50</span>      <span class="co"># number of samples</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plots</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_wcss</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"WCSS"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-8-1.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_silhouette</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"Silhouette"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-8-2.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_gap</span><span class="op">[[</span><span class="st">"Tab"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="st">"gap"</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"Gap"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-8-3.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<p>Based on the WCSS plot, the number of clusters k best fitting the data could range between <code>k = 3</code> and <code>k = 6</code>, which are all around the inflation point (elbow) of the line. The silhouette plot shows a local maximum at <code>k = 3</code> and <code>k = 6</code>, which indicates that the observations best fit within their clusters when 3 or 6 clusters are created. The gap statistic steadily increases until it reaches a plateau around <code>k = 5</code>. That indicates that clustering improves as we move from 2 to 5 clusters, but the quality doesn’t increase as much afterwards. The value for <code>k = 6</code> (which is the value suggested by the other two heuristics) is a local minimum, but still the difference with neighbouring values is relatively small.</p>
<p>Overall, the heuristics seem to indicate that <code>k = 3</code> could lead to a good clustering result. However, the gap statistic indicates that those three clusters would not be very compact. That is probably due to the fact that the observations at center of the scatterplot seen above are rather uniformally distributed over the space between the three main clusters. As such, chosing <code>k = 6</code> clusters might be the best fitting approach in this case. We can then calculate the clusters for <code>k = 6</code> as shown below.</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">terr_sede_kmeans</span> <span class="op">&lt;-</span> <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_semidetached</span>, <span class="va">perc_terraced</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span>centers <span class="op">=</span> <span class="fl">6</span>, iter.max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="va">leicester_dwellings</span> <span class="op">&lt;-</span> 
  <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    terr_sede_cluster <span class="op">=</span> <span class="va">terr_sede_kmeans</span> <span class="op">%$%</span> <span class="va">cluster</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="interpreting-the-clusters" class="section level3" number="10.2.2">
<h3>
<span class="header-section-number">10.2.2</span> Interpreting the clusters<a class="anchor" aria-label="anchor" href="#interpreting-the-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>After the clustering has been completed, we can analyse the results through a visual analysis. For instance, we can plot the two original variables, along with the computed clusters as illustrated below.</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_semidetached</span>, <span class="va">perc_terraced</span>, <span class="va">terr_sede_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">terr_sede_cluster</span><span class="op">)</span>,
    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="va">ggally_cor</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span><span class="op">)</span>,
    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"points"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-10-1.png" width="576"></div>
<p>Another common approach in interpreting the results is to create <em>heatmaps</em> for the average values of the variables used in the clustering process for each cluster.</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">terr_sede_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    avg_perc_semidetached <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">perc_semidetached</span><span class="op">)</span>, 
    avg_perc_terraced <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">perc_terraced</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">terr_sede_cluster</span>, <span class="va">avg_perc_semidetached</span>, <span class="va">avg_perc_terraced</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">terr_sede_cluster</span>,
    names_to <span class="op">=</span> <span class="st">"clustering_dimension"</span>,
    values_to <span class="op">=</span> <span class="st">"value"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">clustering_dimension</span>,
      y <span class="op">=</span> <span class="va">terr_sede_cluster</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Clustering dimension"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-11-1.png" width="480"></div>
<p>The plot above, clearly illustrates how cluster 6 has a high percentage of semi-detached houses and a low percentages of terraced houses. Cluster 2 has a high percentage of terraced houses and a low percentages of semi-detached houses. Cluster 4 has a low percentage of both semi-detached and terraced houses. Those are the three clusters that we first identified from the first scatterplot above.</p>
<p>Moreover, the clustering process identifies cluster 1, which includes similar percentages of semi-detached and terraced houses; as well as cluster 5, including mostly semi-detached but also some terraced houses, and cluster 3, including mostly terraced but also some semi-detached houses.</p>
</div>
<div id="a-geodemographic-of-dwelling-types" class="section level3" number="10.2.3">
<h3>
<span class="header-section-number">10.2.3</span> A geodemographic of dwelling types<a class="anchor" aria-label="anchor" href="#a-geodemographic-of-dwelling-types"><i class="fas fa-link"></i></a>
</h3>
<p>The case study above is useful as a simple example of how to create a geodemographic classification, but possibly not the most interesting analysis due to the limited number of variables used. In this section, we explore the creation of a geodemographic of dwelling types in the city of Leicester, using all five variables available in the original dataset.</p>
<p>As before we can start from a visual analysis of the data. The relationship between the different variables generally resembles the one seen between semi-detached and terraced houses seen in the example above, except for caravans and mobile or temporary structures, which seem fairly rare in Leicester. No variable seems to be particularly well correlated to any other. Thus all variables should be included in the classification, as they all have the potential to contribute relevant information.</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span>
    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="va">ggally_cor</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span><span class="op">)</span>,
    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"points"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-12-1.png" width="432"></div>
<p>In order to identify the number of clusters <code>k</code> which best fits the data, we can use the elbow method, along with the silhouette and gap statistic measures, as seen in the previous example. The only difference is that in this case <code>data_for_testing</code> will include all five variables.</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data for elbow method</span>
<span class="va">data_for_testing</span> <span class="op">&lt;-</span>
  <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span><span class="op">)</span>

<span class="co"># Calculate WCSS and silhouette</span>
<span class="co"># for k = 2 to 15</span>
<span class="co"># Set up two vectors where to store</span>
<span class="co"># the calculated WCSS and silhouette value</span>
<span class="va">testing_wcss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span>
<span class="va">testing_silhouette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span>

<span class="co"># for k = 2 to 15</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">testing_k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Calculate kmeans</span>
  <span class="va">kmeans_result</span> <span class="op">&lt;-</span> 
    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">data_for_testing</span>, centers <span class="op">=</span> <span class="va">testing_k</span>, iter.max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  
  <span class="co"># Extract WCSS</span>
  <span class="co"># and save it in the vector</span>
  <span class="va">testing_wcss</span><span class="op">[</span><span class="va">testing_k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">kmeans_result</span> <span class="op">%$%</span> <span class="va">tot.withinss</span>
  
  <span class="co"># Calculate average silhouette</span>
  <span class="co"># and save it in the vector</span>
  <span class="va">testing_silhouette</span><span class="op">[</span><span class="va">testing_k</span><span class="op">]</span> <span class="op">&lt;-</span> 
    <span class="va">kmeans_result</span> <span class="op">%$%</span> <span class="va">cluster</span> <span class="op">%&gt;%</span>
    <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span>
      <span class="va">data_for_testing</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">extract</a></span><span class="op">(</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Calculate the gap statistic using bootstrapping</span>
<span class="va">testing_gap</span> <span class="op">&lt;-</span> 
  <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/clusGap.html">clusGap</a></span><span class="op">(</span><span class="va">data_for_testing</span>, FUN <span class="op">=</span> <span class="va">kmeans</span>, 
    K.max <span class="op">=</span> <span class="fl">15</span>, B <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plots</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_wcss</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"WCSS"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-14-1.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_silhouette</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"Silhouette"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-14-2.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="va">testing_gap</span><span class="op">[[</span><span class="st">"Tab"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="st">"gap"</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"b"</span>, xlab<span class="op">=</span><span class="st">"Number of Clusters"</span>, 
     ylab<span class="op">=</span><span class="st">"Gap"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-14-3.png" width="576"></div>
<pre><code>## integer(0)</code></pre>
<p>As in the previous example, the elbow method (i.e., WCSS), silhouette and gap statistic seem to indicate that <code>k = 3</code> or <code>k = 6</code> might be the best choice. Let’s see what the result is when choosing <code>k = 6</code>.</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dwellings_kmeans</span> <span class="op">&lt;-</span> <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span>
    centers <span class="op">=</span> <span class="fl">6</span>, 
    iter.max <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span>

<span class="va">leicester_dwellings</span> <span class="op">&lt;-</span> 
  <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    dwellings_cluster <span class="op">=</span> 
      <span class="va">dwellings_kmeans</span> <span class="op">%$%</span> 
        <span class="va">cluster</span> <span class="op">%&gt;%</span>
          <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="interpreting-the-clusters-1" class="section level3" number="10.2.4">
<h3>
<span class="header-section-number">10.2.4</span> Interpreting the clusters<a class="anchor" aria-label="anchor" href="#interpreting-the-clusters-1"><i class="fas fa-link"></i></a>
</h3>
<p>A first exploratory plot of the clusters seems to reveal clusters that closely resemble those seen in the first example above.</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span>, <span class="va">dwellings_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">dwellings_cluster</span><span class="op">)</span>,
    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"points"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-16-1.png" width="576"></div>
<div style="page-break-after: always;"></div>
<p>As in the previous example, we can use an <em>“heatmap”</em> plot to explore how the clusters are characterised by the variables used in the clustering process (see also Exercise 414.1.1 below).</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dwellings_cluster_avgs</span> <span class="op">&lt;-</span>
  <span class="va">leicester_dwellings</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">dwellings_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
      <span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span>,
      <span class="va">mean</span>
    <span class="op">)</span> 
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># rename columns</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>
    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"avg_"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">}</span>,
    <span class="va">perc_detached</span><span class="op">:</span><span class="va">perc_carava_tmp</span>
  <span class="op">)</span>
  
<span class="va">dwellings_cluster_avgs</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">dwellings_cluster</span>,
    names_to <span class="op">=</span> <span class="st">"clustering_dimension"</span>,
    values_to <span class="op">=</span> <span class="st">"value"</span>
  <span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">clustering_dimension</span>,
      y <span class="op">=</span> <span class="va">dwellings_cluster</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      fill <span class="op">=</span> <span class="va">value</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Clustering dimension"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text.x <span class="op">=</span> 
      <span class="fu">element_text</span><span class="op">(</span>
        angle <span class="op">=</span> <span class="fl">90</span>, 
        vjust <span class="op">=</span> <span class="fl">0.5</span>, 
        hjust<span class="op">=</span><span class="fl">1</span>
      <span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-17-1.png" width="384"></div>
<p>Another very common approach to explore the characteristics of the clusters created through k-means for the geodemongraphic classification is to use radar charts (also known as spider charts, web charts or polar charts), which can be created in R using a number of libraries, including the <code>radarchart</code> of the <code>fmsb</code> library.</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("fmsb")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://minato.sip21c.org/msb/">fmsb</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">cluster_number</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span> <span class="op">(</span>
    <span class="co"># The radar chart requires a maximum and a minimum row </span>
    <span class="co"># before the actual data</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, <span class="co"># max 100% for 5 variables</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,   <span class="co"># min 0% for 5 variables</span>
    <span class="va">dwellings_cluster_avgs</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dwellings_cluster</span> <span class="op">==</span> <span class="va">cluster_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">dwellings_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">fmsb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fmsb/man/radarchart.html">radarchart</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="va">cluster_number</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/figures-side-1.png" width="576"></div>
<p>The radar charts are very effective in visualising the values for multiple varaibles, as long as the variables are all of similar type, value and range. In this case, as all values are percentages, radar chart are very effective in illustrating which variables have particularly high averages in each cluster.</p>
<p>Finally, we can map the cluster cartographically to analyse their spatial distribution.</p>
<div class="inline-figure"><img src="410-unsupervised-learning_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
</div>
</div>
<div id="exercise-414.1" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Exercise 414.1<a class="anchor" aria-label="anchor" href="#exercise-414.1"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Question 414.1.1:</strong> Based on the <em>“heatmap”</em>, radar charts and map created in the example above, how would you characterise the five clusters? How would you name them?.</p>
<p><strong>Question 414.1.2:</strong> Create a geodemographic classification using the data seen in the second example above, but creating <code>k = 9</code> clusters.</p>
<p><strong>Question 414.1.3:</strong> Create a geodemographic classification for the city of Leicester based on the presence of peoples in the different age groups included in the <code>2011_OAC_Raw_uVariables_Leicester.csv</code> dataset (<code>u007</code> to <code>u019</code>).</p>
<hr>
<p><small>by <a href="https://sdesabbata.github.io/">Stefano De Sabbata</a> – text licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>, contains public sector information licensed under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence">Open Government Licence v3.0</a>, code licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.html">GNU GPL v3.0</a>.</small></p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="supervised-machine-learning.html"><span class="header-section-number">9</span> Supervised machine learning</a></div>
<div class="next"><a href="solutions.html">Solutions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#unsupervised-machine-learning"><span class="header-section-number">10</span> Unsupervised machine learning</a></li>
<li>
<a class="nav-link" href="#introduction-1"><span class="header-section-number">10.1</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#k-means"><span class="header-section-number">10.1.1</span> K-means</a></li>
<li><a class="nav-link" href="#number-of-clusters"><span class="header-section-number">10.1.2</span> Number of clusters</a></li>
<li><a class="nav-link" href="#geodemographic-classification"><span class="header-section-number">10.1.3</span> Geodemographic Classification</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#unsupervised-learning-examples"><span class="header-section-number">10.2</span> Unsupervised learning examples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#terrace-and-semi-detached-houses"><span class="header-section-number">10.2.1</span> Terrace and semi-detached houses</a></li>
<li><a class="nav-link" href="#interpreting-the-clusters"><span class="header-section-number">10.2.2</span> Interpreting the clusters</a></li>
<li><a class="nav-link" href="#a-geodemographic-of-dwelling-types"><span class="header-section-number">10.2.3</span> A geodemographic of dwelling types</a></li>
<li><a class="nav-link" href="#interpreting-the-clusters-1"><span class="header-section-number">10.2.4</span> Interpreting the clusters</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercise-414.1"><span class="header-section-number">10.3</span> Exercise 414.1</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/sdesabbata/r-for-geographic-data-science/blob/main/src/book/410-unsupervised-learning.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/sdesabbata/r-for-geographic-data-science/edit/main/src/book/410-unsupervised-learning.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Geographic Data Science</strong>" was written by Stefano De Sabbata. It was last built on 2021-11-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
