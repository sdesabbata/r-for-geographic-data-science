<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Table operations | R for Geographic Data Science</title>
<meta name="author" content="Stefano De Sabbata">
<meta name="description" content="Print this chapter The first two sections illustrate the pivot and join functionalities of the Tidyverse libraries using simple examples. The last section instead presents a more complex example,...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 4 Table operations | R for Geographic Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://sdesabbata.github.io/r-for-geographic-data-science/table-operations.html">
<meta property="og:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<meta property="og:description" content="Print this chapter The first two sections illustrate the pivot and join functionalities of the Tidyverse libraries using simple examples. The last section instead presents a more complex example,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Table operations | R for Geographic Data Science">
<meta name="twitter:description" content="Print this chapter The first two sections illustrate the pivot and join functionalities of the Tidyverse libraries using simple examples. The last section instead presents a more complex example,...">
<meta name="twitter:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Geographic Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">1</span> Introduction to R</a></li>
<li><a class="" href="reproducible-data-science.html"><span class="header-section-number">2</span> Reproducible data science</a></li>
<li><a class="" href="data-manipulation.html"><span class="header-section-number">3</span> Data manipulation</a></li>
<li><a class="active" href="table-operations.html"><span class="header-section-number">4</span> Table operations</a></li>
<li class="book-part">Data analysis</li>
<li><a class="" href="exploratory-visualisation.html"><span class="header-section-number">5</span> Exploratory visualisation</a></li>
<li><a class="" href="exploratory-statistics.html"><span class="header-section-number">6</span> Exploratory statistics</a></li>
<li><a class="" href="comparing-data.html"><span class="header-section-number">7</span> Comparing data</a></li>
<li><a class="" href="regression-analysis.html"><span class="header-section-number">8</span> Regression analysis</a></li>
<li><a class="" href="multiple-regression.html"><span class="header-section-number">9</span> Multiple regression</a></li>
<li class="book-part">Machine learning</li>
<li><a class="" href="supervised-machine-learning.html"><span class="header-section-number">10</span> Supervised machine learning</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">11</span> Unsupervised machine learning</a></li>
<li class="book-part">R scripting</li>
<li><a class="" href="r-scripting.html"><span class="header-section-number">12</span> R scripting</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="appendix-1.html">Appendix 1</a></li>
<li><a class="" href="solutions.html">Solutions</a></li>
<li><a class="" href="groupwork-exercise.html">Groupwork exercise</a></li>
<li><a class="" href="lecture-slides.html">Lecture slides</a></li>
<li><a class="" href="reading-list.html">Reading list</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/sdesabbata/r-for-geographic-data-science">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="table-operations" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Table operations<a class="anchor" aria-label="anchor" href="#table-operations"><i class="fas fa-link"></i></a>
</h1>
<p><br><small><a href="javascript:if(window.print)window.print()">Print this chapter</a></small></p>
<p>The first two sections illustrate the pivot and join functionalities of the Tidyverse libraries using simple examples. The last section instead presents a more complex example, loading and wrangling with data related to the <a href="https://github.com/geogale/2011OAC">2011 Output Area Classification</a> and the <a href="https://www.gov.uk/government/statistics/english-indices-of-deprivation-2015">Indexes of Multiple Deprivation 2015</a>.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div id="long-and-wide-table-formats" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Long and wide table formats<a class="anchor" aria-label="anchor" href="#long-and-wide-table-formats"><i class="fas fa-link"></i></a>
</h2>
<p>Tabular data are usually presented in two different formats.</p>
<ul>
<li>
<strong>Wide</strong>: this is the most common approach, where each real-world entity (e.g.Â a city) is represented by <em>one single row</em> and its attributes are represented through different columns (e.g., a column representing the total population in the area, another column representing the size of the area, etc.).</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>City</th>
<th>Population</th>
<th>Area</th>
<th>Density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Leicester</td>
<td>329,839</td>
<td>73.3</td>
<td>4,500</td>
</tr>
<tr class="even">
<td>Nottingham</td>
<td>321,500</td>
<td>74.6</td>
<td>4,412</td>
</tr>
</tbody>
</table></div>
<ul>
<li>
<strong>Long</strong>: this is probably a less common approach, but still necessary in many cases, where each real-world entity (e.g.Â a city) is represented by <em>multiple rows</em>, each one reporting only one of its attributes. In this case, one column is used to indicate which attribute each row represent, and another column is used to report the value.</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>City</th>
<th>Attribute</th>
<th>Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Leicester</td>
<td>Population</td>
<td>329,839</td>
</tr>
<tr class="even">
<td>Leicester</td>
<td>Area</td>
<td>73.3</td>
</tr>
<tr class="odd">
<td>Leicester</td>
<td>Density</td>
<td>4,500</td>
</tr>
<tr class="even">
<td>Nottingham</td>
<td>Population</td>
<td>321,500</td>
</tr>
<tr class="odd">
<td>Nottingham</td>
<td>Area</td>
<td>74.6</td>
</tr>
<tr class="even">
<td>Nottingham</td>
<td>Density</td>
<td>4,412</td>
</tr>
</tbody>
</table></div>
<p>The <code>tidyr</code> library provides two functions that allow transforming wide-formatted data to a long format, and vice-versa. Please take your time to understand the example below and check out the <a href="https://tidyr.tidyverse.org/"><code>tidyr</code> help pages</a> before continuing.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_info_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Leicester"</span>, <span class="st">"Nottingham"</span><span class="op">)</span>,</span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">329839</span>, <span class="fl">321500</span><span class="op">)</span>,</span>
<span>    area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">73.3</span>, <span class="fl">74.6</span><span class="op">)</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4500</span>, <span class="fl">4412</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_info_long</span> <span class="op">&lt;-</span> <span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    <span class="co"># exclude IDs (city names) from the pivoted columns</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">city</span>,</span>
<span>    <span class="co"># name for the new column containing</span></span>
<span>    <span class="co"># the names of the old columns</span></span>
<span>    names_to <span class="op">=</span> <span class="st">"attribute"</span>,</span>
<span>    <span class="co"># name for the new column containing</span></span>
<span>    <span class="co"># the values included under the old columns</span></span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">city_info_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="left">attribute</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="left">population</td>
<td align="right">329839.0</td>
</tr>
<tr class="even">
<td align="left">Leicester</td>
<td align="left">area</td>
<td align="right">73.3</td>
</tr>
<tr class="odd">
<td align="left">Leicester</td>
<td align="left">density</td>
<td align="right">4500.0</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="left">population</td>
<td align="right">321500.0</td>
</tr>
<tr class="odd">
<td align="left">Nottingham</td>
<td align="left">area</td>
<td align="right">74.6</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="left">density</td>
<td align="right">4412.0</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_info_back_to_wide</span> <span class="op">&lt;-</span> <span class="va">city_info_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    <span class="co"># column containing the attribute names</span></span>
<span>    names_from <span class="op">=</span> <span class="va">attribute</span>,</span>
<span>    <span class="co"># column containing the values</span></span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">city_info_back_to_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
</tr>
</tbody>
</table></div>
</div>
<div id="joining-tables" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Joining tables<a class="anchor" aria-label="anchor" href="#joining-tables"><i class="fas fa-link"></i></a>
</h2>
<p>A join operation combines two tables into one by matching rows that have the same values in the specified column. This operation is usually executed on columns containing identifiers, which are matched through different tables containing different data about the same real-world entities. For instance, the table below presents the telephone prefixes for two cities. That information can be combined with the data present in the wide-formatted table above through a join operation on the columns containing the city names. As the two tables do not contain all the same cities, if a full join operation is executed, some cells have no values assigned.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>city</th>
<th>telephone_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Leicester</td>
<td>0116</td>
</tr>
<tr class="even">
<td>Birmingham</td>
<td>0121</td>
</tr>
</tbody>
</table></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>city</th>
<th>population</th>
<th>area</th>
<th>density</th>
<th>telephone_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Leicester</td>
<td>329,839</td>
<td>73.3</td>
<td>4,500</td>
<td>0116</td>
</tr>
<tr class="even">
<td>Nottingham</td>
<td>321,500</td>
<td>74.6</td>
<td>4,412</td>
<td></td>
</tr>
<tr class="odd">
<td>Birmingham</td>
<td></td>
<td></td>
<td></td>
<td>0121</td>
</tr>
</tbody>
</table></div>
<p>As discussed in the lecture, the <code>dplyr</code> library offers different types of join operations, which correspond to the different <code>SQL</code> joins illustrated in the image below. The use and implications of these different types of joins will be discussed in more detail in the GY7708 module next semester.</p>
<div class="inline-figure"><img src="images/joins.png" style="width:75.0%"></div>
<p>Please take your time to understand the example below and check out the <a href="https://dplyr.tidyverse.org/reference/join.html">related <code>dplyr</code> help pages</a> before continuing. The first four examples execute the exact same <em>full join</em> operation using three different syntaxes: with or without using the pipe operator, and specifying the <code>by</code> argument or not. Note that all those approaches to writing the join are valid and produce the same result. The choice about which approach to use will depend on the code you are writing. In particular, you might find it useful to use the syntax that uses the pipe operator when the join operation is itself only one stem in a series of data manipulation steps. Using the <code>by</code> argument is usually advisable unless you are certain that you aim to join two tables with all and exactly the column that have the same names in the two table.</p>
<p>Note how the result of the join operations is <em>not</em> saved to a variable. The function <code>kable</code> is added after each join operation through a pipe <code>%&gt;%</code> to display the resulting table in a nice format.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_telephone_prexix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Leicester"</span>, <span class="st">"Birmingham"</span><span class="op">)</span>,</span>
<span>    telephon_prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0116"</span>, <span class="st">"0121"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">city_telephone_prexix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Birmingham</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: without using the pipe operator</span></span>
<span></span>
<span><span class="co"># full join verb</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>,</span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Birmingham</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 2: without using the pipe operator</span></span>
<span><span class="co">#   and without using the argument "by"</span></span>
<span><span class="co">#   as columns have the same name</span></span>
<span><span class="co">#   in the two tables.</span></span>
<span><span class="co"># Same result as Option 1</span></span>
<span></span>
<span><span class="co"># full join verb</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>,</span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Birmingham</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 3: using the pipe operator</span></span>
<span><span class="co">#   and without using the argument "by"</span></span>
<span><span class="co">#   as columns have the same name</span></span>
<span><span class="co">#   in the two tables.</span></span>
<span><span class="co"># Same result as Option 1 and 2</span></span>
<span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># full join verb</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Birmingham</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 4: using the pipe operator</span></span>
<span><span class="co">#   and using the argument "by".</span></span>
<span><span class="co"># Same result as Option 1, 2 and 3</span></span>
<span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># full join verb</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Birmingham</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Left join</span></span>
<span><span class="co"># Using syntax similar to Option 1 above</span></span>
<span></span>
<span><span class="co"># left join</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>, </span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Nottingham</td>
<td align="right">321500</td>
<td align="right">74.6</td>
<td align="right">4412</td>
<td align="left">NA</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Right join</span></span>
<span><span class="co"># Using syntax similar to Option 2 above</span></span>
<span></span>
<span><span class="co"># right join verb</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>, </span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr>
<tr class="even">
<td align="left">Birmingham</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">0121</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inner join</span></span>
<span><span class="co"># Using syntax similar to Option 3 above</span></span>
<span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># inner join</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">city</th>
<th align="right">population</th>
<th align="right">area</th>
<th align="right">density</th>
<th align="left">telephon_prefix</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Leicester</td>
<td align="right">329839</td>
<td align="right">73.3</td>
<td align="right">4500</td>
<td align="left">0116</td>
</tr></tbody>
</table></div>
</div>
<div id="data-indices-of-multiple-deprivation" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Data: Indices of Multiple Deprivation<a class="anchor" aria-label="anchor" href="#data-indices-of-multiple-deprivation"><i class="fas fa-link"></i></a>
</h2>
<p>Open the <code>Leicester_population</code> project created for the previous chapter. Create a new RMarkdown document using <em>âExploring deprivation indices in Leicesterâ</em> as the title and <em>PDF</em> as the output file type. Delete the example code after the <code>setup</code> chunk. Add a new markdown second-heading section named <em>Libraries</em> and a chunk loading the <code>tidyverse</code> and <code>knitr</code> libraries (see below). Save the file with the name <code>exploring_Leicester_deprivation.Rmd</code> in the <em>Leicester_population</em> project.</p>
<p>Download from Blackboard (or the <a href="https://github.com/sdesabbata/granolarr/tree/master/data">data</a> folder of the repository) the file <code>IndexesMultipleDeprivation2015_Leicester.csv</code> and upload the file to the <em>Leicester_population</em> folder by clicking on the <em>Upload</em> button and selecting the files from your computer.</p>
<p>The <a href="https://www.gov.uk/government/statistics/english-indices-of-deprivation-2015">Indices of Multiple Deprivation 2015</a> (see <a href="https://maps.cdrc.ac.uk/#/geodemographics/imde2015">map at cdrc.ac.uk</a>) are based on a series of variables across seven distinct domains of deprivation which are combined to calculate the Index of Multiple Deprivation 2015 (IMD 2015). That is an overall measure of multiple deprivations experienced by people living in an area. These indexes are calculated for every Lower layer Super Output Area (LSOA), which are larger geographic units than the OAs used for the 2011 OAC. The dataset in the file <code>IndexesMultipleDeprivation2015_Leicester.csv</code> contains the main Index of Multiple Deprivation, as well as the values for the seven distinct domains of deprivation and two additional indexes regarding deprivation affecting children and older people. The dataset includes scores, ranks (where 1 indicates the most deprived area), and decile (i.e., the first decile includes the 10% most deprived areas in England).</p>
<!--
Note that the `~` in the path below indicates the home folder -- a different path might be necessary if you execute this on a windows machine, please see also [file.path](https://stat.ethz.ch/R-manual/R-devel/library/base/html/file.path.html).
-->
<p>The code below loads the IMD 2015 dataset.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Indexes of Multiple deprivation data</span></span>
<span><span class="va">leicester_IMD2015</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"IndexesMultipleDeprivation2015_Leicester.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"2011_OAC_Raw_uVariables_Leicester.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="working-with-multiple-tables" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Working with multiple tables<a class="anchor" aria-label="anchor" href="#working-with-multiple-tables"><i class="fas fa-link"></i></a>
</h2>
<div id="from-long-to-wide-table" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> From long to wide table<a class="anchor" aria-label="anchor" href="#from-long-to-wide-table"><i class="fas fa-link"></i></a>
</h3>
<p>The IMD 2015 data are in a <em>long</em> format, which means that every area is represented by more than one row: the column <code>Value</code> presents the value; the column <code>IndicesOfDeprivation</code> indicates which index the value refers to; the column <code>Measurement</code> indicates whether the value is a score, rank, or decile. The code below illustrates the data format used for the <code>IndicesOfDeprivation</code> table, and showing the rows for the LSOA including the University of Leicester (feature code <code>E01013649</code>).</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">FeatureCode</span> <span class="op">==</span> <span class="st">"E01013649"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">FeatureCode</span>, <span class="va">IndicesOfDeprivation</span>, <span class="va">Measurement</span>, <span class="va">Value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="13%">
<col width="62%">
<col width="13%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">FeatureCode</th>
<th align="left">IndicesOfDeprivation</th>
<th align="left">Measurement</th>
<th align="right">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Domain</td>
<td align="left">Score</td>
<td align="right">0.070</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Employment Deprivation Domain</td>
<td align="left">Score</td>
<td align="right">0.075</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Children Index (IDACI)</td>
<td align="left">Score</td>
<td align="right">0.087</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Older People Index (IDAOPI)</td>
<td align="left">Score</td>
<td align="right">0.153</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Health Deprivation and Disability Domain</td>
<td align="left">Score</td>
<td align="right">0.272</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Index of Multiple Deprivation (IMD)</td>
<td align="left">Score</td>
<td align="right">19.665</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Education, Skills and Training Domain</td>
<td align="left">Score</td>
<td align="right">2.195</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Barriers to Housing and Services Domain</td>
<td align="left">Score</td>
<td align="right">14.324</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Living Environment Deprivation Domain</td>
<td align="left">Score</td>
<td align="right">57.197</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Crime Domain</td>
<td align="left">Score</td>
<td align="right">1.159</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Domain</td>
<td align="left">Rank</td>
<td align="right">23511.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Index of Multiple Deprivation (IMD)</td>
<td align="left">Rank</td>
<td align="right">14539.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Employment Deprivation Domain</td>
<td align="left">Rank</td>
<td align="right">21227.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Education, Skills and Training Domain</td>
<td align="left">Rank</td>
<td align="right">30744.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Barriers to Housing and Services Domain</td>
<td align="left">Rank</td>
<td align="right">23885.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Health Deprivation and Disability Domain</td>
<td align="left">Rank</td>
<td align="right">12269.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Living Environment Deprivation Domain</td>
<td align="left">Rank</td>
<td align="right">1197.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Crime Domain</td>
<td align="left">Rank</td>
<td align="right">2214.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Children Index (IDACI)</td>
<td align="left">Rank</td>
<td align="right">22984.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Older People Index (IDAOPI)</td>
<td align="left">Rank</td>
<td align="right">16055.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Employment Deprivation Domain</td>
<td align="left">Decile</td>
<td align="right">7.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Older People Index (IDAOPI)</td>
<td align="left">Decile</td>
<td align="right">5.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Barriers to Housing and Services Domain</td>
<td align="left">Decile</td>
<td align="right">8.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Affecting Children Index (IDACI)</td>
<td align="left">Decile</td>
<td align="right">7.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Crime Domain</td>
<td align="left">Decile</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Income Deprivation Domain</td>
<td align="left">Decile</td>
<td align="right">8.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Health Deprivation and Disability Domain</td>
<td align="left">Decile</td>
<td align="right">4.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Living Environment Deprivation Domain</td>
<td align="left">Decile</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="left">E01013649</td>
<td align="left">Education, Skills and Training Domain</td>
<td align="left">Decile</td>
<td align="right">10.000</td>
</tr>
<tr class="even">
<td align="left">E01013649</td>
<td align="left">Index of Multiple Deprivation (IMD)</td>
<td align="left">Decile</td>
<td align="right">5.000</td>
</tr>
</tbody>
</table></div>
<p>In the following section, the analysis aims to explore how certain census variables vary in areas with different deprivation levels. Thus, we need to extract the <code>Decile</code> rows from the IMD 2015 dataset and transform the data in a <em>wide</em> format, where each index is represented as a separate column.</p>
<p>To that purpose, we also need to change the name of the indexes slightly, to exclude spaces and punctuation, so that the new column names are simpler than the original text, and can be used as column names. That part of the manipulation is performed using <code>mutate</code> and functions from the <a href="https://stringr.tidyverse.org/"><code>stringr</code> library</a>.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_IMD2015_decile_wide</span> <span class="op">&lt;-</span> <span class="va">leicester_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Select only Socres</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Measurement</span> <span class="op">==</span> <span class="st">"Decile"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Trim names of IndicesOfDeprivation</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    IndicesOfDeprivation <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">IndicesOfDeprivation</span>, <span class="st">"\\s"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    IndicesOfDeprivation <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">IndicesOfDeprivation</span>, <span class="st">"[:punct:]"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    IndicesOfDeprivation <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">IndicesOfDeprivation</span>, <span class="st">"\\("</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    IndicesOfDeprivation <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">IndicesOfDeprivation</span>, <span class="st">"\\)"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Spread</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">IndicesOfDeprivation</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">Value</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Drop columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">DateCode</span>, <span class="op">-</span><span class="va">Measurement</span>, <span class="op">-</span><span class="va">Units</span><span class="op">)</span></span></code></pre></div>
<p>Letâs compare the columns of the original <em>long</em> IMD 2015 dataset with the <em>wide</em> dataset created above, using the function <code>colnames</code>.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># limit width of printing area</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "FeatureCode"          "DateCode"            
## [3] "Measurement"          "Units"               
## [5] "Value"                "IndicesOfDeprivation"</code></pre>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_IMD2015_decile_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># limit width of printing area</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "FeatureCode"                                     
##  [2] "HealthDeprivationandDisabilityDomain"            
##  [3] "IncomeDeprivationAffectingOlderPeopleIndexIDAOPI"
##  [4] "BarrierstoHousingandServicesDomain"              
##  [5] "EmploymentDeprivationDomain"                     
##  [6] "EducationSkillsandTrainingDomain"                
##  [7] "LivingEnvironmentDeprivationDomain"              
##  [8] "IncomeDeprivationAffectingChildrenIndexIDACI"    
##  [9] "CrimeDomain"                                     
## [10] "IndexofMultipleDeprivationIMD"                   
## [11] "IncomeDeprivationDomain"</code></pre>
<p>In <code>leicester_IMD2015_decile_wide</code>, we now have only one row representing the LSOA including the University of Leicester (feature code <code>E01013649</code>) and the main Index of Multiple Deprivations is now represented by the column <code>IndexofMultipleDeprivationIMD</code>. The value reported is the same â that is 5, which means that the selected LSOA is estimated to be in the range 40-50% most deprived areas in England â but we changed the data format.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original long IMD 2015 dataset</span></span>
<span><span class="va">leicester_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">FeatureCode</span> <span class="op">==</span> <span class="st">"E01013649"</span>,</span>
<span>    <span class="va">IndicesOfDeprivation</span> <span class="op">==</span> <span class="st">"Index of Multiple Deprivation (IMD)"</span>,</span>
<span>    <span class="va">Measurement</span> <span class="op">==</span> <span class="st">"Decile"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">FeatureCode</span>, <span class="va">IndicesOfDeprivation</span>, <span class="va">Measurement</span>, <span class="va">Value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">FeatureCode</th>
<th align="left">IndicesOfDeprivation</th>
<th align="left">Measurement</th>
<th align="right">Value</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">E01013649</td>
<td align="left">Index of Multiple Deprivation (IMD)</td>
<td align="left">Decile</td>
<td align="right">5</td>
</tr></tbody>
</table></div>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># New wide IMD 2015 dataset</span></span>
<span><span class="va">leicester_IMD2015_decile_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">FeatureCode</span> <span class="op">==</span> <span class="st">"E01013649"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">FeatureCode</span>, <span class="va">IndexofMultipleDeprivationIMD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">FeatureCode</th>
<th align="right">IndexofMultipleDeprivationIMD</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">E01013649</td>
<td align="right">5</td>
</tr></tbody>
</table></div>
</div>
<div id="joining-tables-1" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Joining tables<a class="anchor" aria-label="anchor" href="#joining-tables-1"><i class="fas fa-link"></i></a>
</h3>
<p>As discussed above, two tables can be joined using a common column of identifiers. We can thus join the 2011 OAC and the IMD 2015 datasets into a single table. The LSOA code included in the 2011 OAC table is used to match that information with the corresponding row in the IMD 2015. The resulting table provides all the information from the 2011 OAC for each OA, plus the Index of Multiple Deprivations decile for the LSOA containing each OA.</p>
<p>That operation can be carried out using the function <code>inner_join</code>, and specifying the common column (or columns, if more than one is to be used as identifier) as argument of <code>by</code>. Note that using <code>inner_join</code> would result in dropping any row which doesnât have a match in the other table, either way. In this case, that should not happen, as all OAs are part of an LSOA, and any LSOA contains at least one OA.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC_IMD2015</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">leicester_2011OAC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">leicester_IMD2015_decile_wide</span>, </span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LSOA11CD"</span> <span class="op">=</span> <span class="st">"FeatureCode"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As each LSOA contains multiple OAs, each row from the <code>leicester_IMD2015_decile_wide</code> table is matched to multiple rows from the <code>leicester_2011OAC</code> table. For instance, as shown in the table below, the information from the IMD 2015 dataset about the LSOA encompassing the University of Leicester (feature code <code>E01013649</code>) is joined to multiple rows from the 2011 OAC dataset, including the OA encompassing the University of Leicester (feature code <code>E00068890</code>) as well as other neighbouring OAs.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Note that the LSOA11CD column needs to be used</span></span>
<span>  <span class="co"># as the previous join as combined </span></span>
<span>  <span class="co"># LSOA11CD and FeatureCode</span></span>
<span>  <span class="co"># into one, name LSOA11CD</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">LSOA11CD</span> <span class="op">==</span> <span class="st">"E01013649"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">LSOA11CD</span>, <span class="va">supgrpname</span>, <span class="va">IndexofMultipleDeprivationIMD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">OA11CD</th>
<th align="left">LSOA11CD</th>
<th align="left">supgrpname</th>
<th align="right">IndexofMultipleDeprivationIMD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E00169447</td>
<td align="left">E01013649</td>
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">E00168083</td>
<td align="left">E01013649</td>
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">E00068893</td>
<td align="left">E01013649</td>
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">E00068892</td>
<td align="left">E01013649</td>
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">E00068890</td>
<td align="left">E01013649</td>
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
</tr>
</tbody>
</table></div>
<p>Once the result is stored into the variable <code>leicester_2011OAC_IMD2015</code>, further analysis can be carried out. For instance, <code>count</code> can be used to count how many OAs fall into each 2011 OAC supergroup and decile of the Index of Multiple Deprivations.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">supgrpname</span>, <span class="va">IndexofMultipleDeprivationIMD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">supgrpname</th>
<th align="right">IndexofMultipleDeprivationIMD</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Constrained City Dwellers</td>
<td align="right">1</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">Constrained City Dwellers</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Constrained City Dwellers</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Constrained City Dwellers</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Cosmopolitans</td>
<td align="right">2</td>
<td align="right">25</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">3</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">Cosmopolitans</td>
<td align="right">4</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">Cosmopolitans</td>
<td align="right">6</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Cosmopolitans</td>
<td align="right">8</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">1</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">Ethnicity Central</td>
<td align="right">2</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Ethnicity Central</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity Central</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">1</td>
<td align="right">68</td>
</tr>
<tr class="odd">
<td align="left">Hard-Pressed Living</td>
<td align="right">2</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Hard-Pressed Living</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Hard-Pressed Living</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">1</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">Multicultural Metropolitans</td>
<td align="right">2</td>
<td align="right">119</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">3</td>
<td align="right">132</td>
</tr>
<tr class="even">
<td align="left">Multicultural Metropolitans</td>
<td align="right">4</td>
<td align="right">100</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">5</td>
<td align="right">56</td>
</tr>
<tr class="even">
<td align="left">Multicultural Metropolitans</td>
<td align="right">6</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">7</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Multicultural Metropolitans</td>
<td align="right">8</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">Multicultural Metropolitans</td>
<td align="right">9</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Suburbanites</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Suburbanites</td>
<td align="right">5</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">6</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Suburbanites</td>
<td align="right">7</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">Suburbanites</td>
<td align="right">8</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Suburbanites</td>
<td align="right">9</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">4</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">5</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">6</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">7</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">Urbanites</td>
<td align="right">8</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Urbanites</td>
<td align="right">9</td>
<td align="right">4</td>
</tr>
</tbody>
</table></div>
<p>As another example, the code below can be used to group OAs based on the decile and then calculate the percentage of adults not in employment using the <code>u074</code> (<em>No adults in employment in household: With dependent children</em>) and <code>u075</code> (<em>No adults in employment in household: No dependent children</em>) variables from the 2011 OAC dataset.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leicester_2011OAC_IMD2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">IndexofMultipleDeprivationIMD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    adults_not_empl_perc <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">u074</span> <span class="op">+</span> <span class="va">u075</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">IndexofMultipleDeprivationIMD</th>
<th align="right">adults_not_empl_perc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">17.071876</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">14.191205</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">10.405029</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">9.966309</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">11.337036</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">10.710509</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">10.641026</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">9.686658</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">9.898140</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="exercise-104.1" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Exercise 104.1<a class="anchor" aria-label="anchor" href="#exercise-104.1"><i class="fas fa-link"></i></a>
</h2>
<p>Extend the <em>âExploring deprivation indices in Leicesterâ</em> document to include the code necessary to solve the questions below. Use the full list of variable names from the 2011 UK Census used to generate the 2011 OAC that can be found in the file <code>2011_OAC_Raw_uVariables_Lookup.csv</code> to indetify which columns to use to complete the tasks.</p>
<p><strong>Question 104.1.1:</strong> Write a piece of code using the pipe operator and the <code>dplyr</code> library to generate a table showing the percentage of EU citizens over total population, calculated grouping OAs by the related decile of the Index of Multiple Deprivations, but only accounting for areas classified as Cosmopolitans or Ethnicity Central or Multicultural Metropolitans.</p>
<p><strong>Question 104.1.2:</strong> Write a piece of code using the pipe operator and the <code>dplyr</code> library to generate a table showing the percentage of EU citizens over total population, calculated grouping OAs by the related supergroup in the 2011 OAC, but only accounting for areas in the top 5 deciles of the Index of Multiple Deprivations.</p>
<p><strong>Question 104.1.3:</strong> Write a piece of code using the pipe operator and the <code>dplyr</code> library to generate a table showing the percentage of people aged 65 and above, calculated grouping OAs by the related supergroup in the 2011 OAC and decile of the Index of Multiple Deprivations, and ordering the table by the calculated value in a descending order.</p>
<p><strong>Question 104.1.4:</strong> Write a piece of code using the pipe operator and the <code>dplyr</code> and <code>tidyr</code> libraries to generate a long format of the <code>leicester_2011OAC_IMD2015</code> table only including the values (census variables) used in <em>Question 104.1.3</em>.</p>
<p><strong>Question 104.1.5:</strong> Write a piece of code using the pipe operator and the <code>dplyr</code> and <code>tidyr</code> libraries to generate a table similar to the one generated for <em>Question 104.1.4</em>, but showing the values as percentages over total population.</p>
<!--
## Solutions

A full R Script including the code for the analysis presented in this chapter and the solutions to the 5 questions above is available in the Exercises folder (`docs/exercises`) of the repository (`202_X_Data_Wrangling2_Example.R`). Upload the prepared script to your *Practical_214* project folder, click on the uploaded file to open it in a new editor tab and compare it to your script.

-->
<hr>
<p><small>by <a href="https://sdesabbata.github.io/">Stefano De Sabbata</a> â text licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>, contains public sector information licensed under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence">Open Government Licence v3.0</a>, code licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.html">GNU GPL v3.0</a>.</small></p>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="data-manipulation.html"><span class="header-section-number">3</span> Data manipulation</a></div>
<div class="next"><a href="exploratory-visualisation.html"><span class="header-section-number">5</span> Exploratory visualisation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#table-operations"><span class="header-section-number">4</span> Table operations</a></li>
<li><a class="nav-link" href="#long-and-wide-table-formats"><span class="header-section-number">4.1</span> Long and wide table formats</a></li>
<li><a class="nav-link" href="#joining-tables"><span class="header-section-number">4.2</span> Joining tables</a></li>
<li><a class="nav-link" href="#data-indices-of-multiple-deprivation"><span class="header-section-number">4.3</span> Data: Indices of Multiple Deprivation</a></li>
<li>
<a class="nav-link" href="#working-with-multiple-tables"><span class="header-section-number">4.4</span> Working with multiple tables</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#from-long-to-wide-table"><span class="header-section-number">4.4.1</span> From long to wide table</a></li>
<li><a class="nav-link" href="#joining-tables-1"><span class="header-section-number">4.4.2</span> Joining tables</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercise-104.1"><span class="header-section-number">4.5</span> Exercise 104.1</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/sdesabbata/r-for-geographic-data-science/blob/main/src/book/104-table-operations.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/sdesabbata/r-for-geographic-data-science/edit/main/src/book/104-table-operations.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Geographic Data Science</strong>" was written by Stefano De Sabbata. It was last built on 2024-05-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
